----- bastion server-------

sudo apt install nginx -y
sudo systemctl enable nginx
sudo systemctl start nginx
curl localhost:80

sudo systemctl daemon-reload
sudo systemctl enable frontend
sudo systemctl start frontend

# bastion
nginx -t
sudo systemctl reload nginx

# nginx frontend
sudo nano /etc/nginx/sites-available/frontend
sudo ln -s /etc/nginx/sites-available/frontend /etc/nginx/sites-enabled/
sudo nginx -t
sudo systemctl reload nginx
# nginx frontend file

server {
    listen 80;
    server_name _;  # catches all requests to this server

    # Frontend proxy
    location / {
        proxy_pass http://10.0.3.250:3000;   # your frontend private IP
        proxy_http_version 1.1;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;

        # Optional for WebSockets
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection "upgrade";

        # Timeouts
        proxy_connect_timeout 10s;
        proxy_send_timeout 30s;
        proxy_read_timeout 30s;
    }
	
    # attandance proxy
    location /api/attendance {
        proxy_pass http://10.0.2.75:8081;   # your employee private IP
        proxy_http_version 1.1;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;

        # Optional for WebSockets
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection "upgrade";

        # Timeouts
        proxy_connect_timeout 10s;
        proxy_send_timeout 30s;
        proxy_read_timeout 30s;
    }
	
    # employee proxy
    location /api/employee {
        proxy_pass http://10.0.2.75:8080;   # your employee private IP
        proxy_http_version 1.1;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;

        # Optional for WebSockets
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection "upgrade";

        # Timeouts
        proxy_connect_timeout 10s;
        proxy_send_timeout 30s;
        proxy_read_timeout 30s;
    }
    # employee proxy
    location /api/salary {
        proxy_pass http://10.0.2.75:8082;   # your employee private IP
        proxy_http_version 1.1;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;

        # Optional for WebSockets
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection "upgrade";

        # Timeouts
        proxy_connect_timeout 10s;
        proxy_send_timeout 30s;
        proxy_read_timeout 30s;
    }    
}

path accesible from bastion

curl http://10.0.2.75:8080/api/v1/employee/health
curl http://10.0.2.75:8081/api/v1/attendance/health
curl http://10.0.2.75:8082/api/v1/salary/search/all


#bastion to employee wiorking path
curl http://54.88.219.92/api/v1/employee/health/detail
 curl http://54.88.219.92/api/v1/employee/health
 curl http://54.88.219.92/api/v1/employee/search/all
curl http://54.88.219.92/api/v1/employee/search/location?officeLocation=Bangalore
curl http://54.88.219.92/api/v1/employee/search/designation?designation=Software%20Engineer



# attendance creation
curl -X POST http://10.0.2.75:8081/api/v1/attendance/create \
-H "Content-Type: application/json" \
-d '{
  "id": "EMP005",
  "name": "Alice Johnson",
  "status": "present",
  "date": "2024-01-17"
}'
# bastion to employee db creation
 curl -X POST http://10.0.2.75:8080/api/v1/employee/create \
-H "Content-Type: application/json" \
-d '{
  "id": "emp010",
  "name": "John Doe",
  "email": "john.doe@test.com",
  "phone_number": "9876543210",
  "department": "IT",
  "designation": "Software Engineer",
  "office_location": "Bangalore",
  "address": "MG Road",
  "joining_date": "2024-01-15",
  "status": "ACTIVE"
}'
